# VoiceForce 音声操作リファレンス

> **使い方**: `Option+V`（Mac）を押しながら発話 → 離す
> Salesforce のページ上でのみ動作します。

---

## 目次

1. [一覧ページへ移動する](#1-一覧ページへ移動する)
2. [レコードを検索する](#2-レコードを検索する)
3. [レコードを作成する](#3-レコードを作成する)
4. [レコードを更新する](#4-レコードを更新する)
5. [情報を集計・要約する](#5-情報を集計要約する)
6. [画面操作コマンド](#6-画面操作コマンド)
7. [対応オブジェクト一覧](#7-対応オブジェクト一覧)
8. [処理の仕組み（技術メモ）](#8-処理の仕組み技術メモ)

---

## 1. 一覧ページへ移動する

### 基本の一覧

| 発話例 | 動作 |
|---|---|
| 「商談」 | 商談の一覧を開く |
| 「商談一覧を開いて」 | 商談の一覧を開く |
| 「商談の一覧を表示してください」 | 商談の一覧を開く |
| 「商談を開いて」「商談出して」「商談見せて」 | 商談の一覧を開く |
| 「取引先一覧」「リード一覧を開いて」 | 各オブジェクトの一覧を開く |

**対応する言い回し（動詞）**: 開いて / 出して / 見せて / 表示して / 表示 / 開く / 開け

### フィルター指定

| 発話例 | フィルター |
|---|---|
| 「すべての商談を開いて」 | すべての商談（All） |
| 「全ての商談を開いて」「全部の商談」 | すべての商談（All） |
| 「商談のすべてを開いて」 | すべての商談（All） |
| 「最近参照した商談を開いて」 | 最近参照した商談（RecentlyViewed） |
| 「最近の商談を開いて」「最近見た商談」 | 最近参照した商談（RecentlyViewed） |
| 「自分の商談を開いて」 | 私の商談（MyOpportunities） |
| 「私の商談一覧」「自分の商談一覧を開いて」 | 私の商談（MyOpportunities） |

### 誤認識への対応

| 実際の発話 | Google が認識する言葉 | 動作 |
|---|---|---|
| 「商談一覧」 | 「相談一覧」と認識されても | 正しく商談一覧を開く ✓ |

---

## 2. レコードを検索する

> **処理**: LLM（Claude Haiku）が解釈します。少し時間がかかります。

| 発話例 | 動作 |
|---|---|
| 「山田商事の商談を検索して」 | 取引先名「山田商事」の商談を検索 |
| 「田中さんのリードを探して」 | 氏名「田中」のリードを検索 |
| 「先週作った取引先を見つけて」 | 条件に合う取引先を検索 |

**検索結果が複数件の場合**: 候補リストが表示されます。
→ 「1番」「2番」などと発話して選択できます（最大5件）

---

## 3. レコードを作成する

> **処理**: LLM（Claude Haiku）が解釈します。

| 発話例 | 動作 |
|---|---|
| 「山田商事の商談を作って」 | 取引先「山田商事」の商談を新規作成 |
| 「田中太郎さんのリードを作成して、会社は山田商事」 | リードを作成（複数項目を一度に指定） |
| 「来週の月曜に山田商事との打ち合わせを行動登録して」 | 行動（Event）を作成 |

**確認ダイアログ**: 作成前に「○○を作成します。よろしいですか？」と確認します。
→「はい」で実行、「いいえ」でキャンセル

---

## 4. レコードを更新する

> **処理**: LLM（Claude Haiku）が解釈します。
> **安全設計**: 更新前に必ず確認ダイアログが表示されます。「元に戻して」で取消し可能。

| 発話例 | 動作 |
|---|---|
| 「山田商事の商談のフェーズを提案中に変えて」 | 商談フェーズを「提案中」に更新 |
| 「この商談の金額を500万に更新して」 | 現在表示中のレコードの金額を更新 |
| 「田中さんのリードの電話番号を03-1234-5678に変更して」 | リードの電話番号を更新 |

**更新フロー**:
```
発話 → LLM解析 → 確認ダイアログ表示 → 「はい」→ Salesforce更新
                                     → 「いいえ」→ キャンセル
```

**更新を取り消す（undo）**:
→「元に戻して」「取り消して」で直前の更新を復元できます（最大10件まで遡れます）

---

## 5. 情報を集計・要約する

> **処理**: LLM（Claude Haiku）が解釈します。

| 発話例 | 動作 |
|---|---|
| 「今日のスケジュールを教えて」 | 本日の行動（Event）を要約 |
| 「今月の商談パイプラインを教えて」 | 進行中の商談を集計 |
| 「最近の活動を教えて」 | 最近の活動履歴を要約 |
| 「商談の件数を教えて」 | 商談の総件数を集計 |

---

## 6. 画面操作コマンド

> **処理**: ruleEngine（正規表現）で即座に実行します。LLMは使いません。

### ナビゲーション

| 発話 | 動作 |
|---|---|
| 「戻って」「戻る」「バック」「前の画面」 | ブラウザの「戻る」（history.back） |

### 確認ダイアログへの応答

| 「はい」と言う | 「いいえ」と言う |
|---|---|
| はい / うん / OK / オッケー | いいえ / いや / やめて / キャンセル |
| いいよ / お願い / 実行して / そう / ええ | 違う / やめ / だめ / ダメ |

### 候補選択（検索結果が複数件のとき）

| 発話 | 動作 |
|---|---|
| 「1番」「2番」「3番」「4番」「5番」 | 番号で候補を選択 |
| 「一番」「二番」「三番」「四番」「五番」 | 漢数字でも選択できる |

### 取り消し

| 発話 | 動作 |
|---|---|
| 「元に戻して」「取り消して」「アンドゥ」「取り消し」「やり直し」 | 直前の更新を復元（最大10回） |

### 停止

| 発話 | 動作 |
|---|---|
| 「止めて」「停止」「ストップ」「終わり」「おしまい」 | 音声入力を停止してウィジェットを閉じる |

### ヘルプ

| 発話 | 動作 |
|---|---|
| 「ヘルプ」「使い方」「何ができる」「help」 | 使い方ガイドを表示 |

---

## 7. 対応オブジェクト一覧

| 発話 | Salesforce オブジェクト |
|---|---|
| 商談 | Opportunity |
| 取引先 | Account |
| 取引先責任者 | Contact |
| リード | Lead |
| タスク / ToDo | Task |
| 行動 | Event |

> **誤認識対応**: 「相談」と認識された場合も「商談（Opportunity）」として処理します。

---

## 8. 処理の仕組み（技術メモ）

### 2ステップ処理

```
発話テキスト
    │
    ▼
┌─────────────────────────────────────────┐
│ Step 1: ruleEngine（正規表現）           │  ← 約 30〜40% のコマンドをここで処理
│  - 一覧ナビゲーション                    │    LLM を使わず即座に実行
│  - 確認応答 / 戻る / 停止 / undo / 選択  │
└────────────────────┬────────────────────┘
                     │ マッチしなかった場合
                     ▼
┌─────────────────────────────────────────┐
│ Step 2: LLM（Claude Haiku）             │  ← 残り 60〜70% をここで処理
│  - 検索 / 作成 / 更新 / 要約             │    Cloudflare Worker 経由
│  - 自然な日本語を柔軟に解釈              │
└─────────────────────────────────────────┘
```

### 利用制限（フリープラン）

- 1日あたり **10回** まで LLM を使う操作が可能
- ruleEngine で処理されるコマンド（一覧ナビゲーション等）は制限なし
- レート制限: **1分あたり10回**

### プライバシー

- Salesforce の顧客データは外部サーバーを**一切経由しない**
- 送信されるのは「発話テキスト」と「Salesforce オブジェクト定義（メタデータ）」のみ
- アクセストークンは AES-256-GCM で端末内に暗号化保存

---

## 今後追加予定の操作

> 現在の実装では未対応。フィードバック・優先度に応じて追加予定。

| 操作 | 発話例 |
|---|---|
| 特定レコードへ直接移動 | 「山田商事を開いて」 |
| レコードの項目を読み上げ | 「この商談の金額を教えて」 |
| 複数レコードの一括更新 | 「今月の商談のフェーズを全部クローズに変えて」 |
| レポートを開く | 「今月の売上レポートを開いて」 |
| Chatter に投稿 | 「この商談に『提案書を送付しました』と投稿して」 |

---

*最終更新: 2026-02-23*
*関連: `lib/ruleEngine.js` / `worker/index.js` / `docs/testing-guide.md`*
